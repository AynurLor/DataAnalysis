# DataAnalysis
Анализ данных и статистика для школы 21.

## О проекте

В данном проекте Вам предстоит закрепить на практике ваши знания SQL. 
Вам нужно будет создать базу данных со знаниями о Школе 21 и написать процедуры и функции для получения информации, а также процедуры и триггеры для её изменения.

## Part 1. Создание базы данных

Напишите скрипт `part1.sql`, создающий базу данных и все таблицы, описанные выше. 

Также внесите в скрипт процедуры, позволяющие импортировать и экспортировать данные для каждой таблицы из файла/в файл с расширением `.csv`. В качестве параметра каждой процедуры указывается разделитель `csv` файла.

В каждую из таблиц внесите как минимум по 5 записей. По мере выполнения задания вам потребуются новые данные, чтобы проверить все варианты работы. Эти новые данные также должны быть добавлены в этом скрипте.

Если для добавления данных в таблицы использовались `csv` файлы, они также должны быть выгружены в GIT репозиторий.

*Все задания должны быть названы в формате названий для Школы 21, например A5_s21_memory. В дальнейшем принадлежность к блоку будет определяться по содержанию в названии задания названия блока

## Part 2. Изменение данных
Создайте скрипт part2.sql, в котором реализованы следующие задачи. Внесите также тестовые запросы/вызовы для каждого пункта.

1) Написать процедуру добавления P2P проверки
Параметры: ник проверяемого, ник проверяющего, название задания, статус P2P проверки, время.

Если задан статус "начало", добавить запись в таблицу Checks (используя сегодняшнюю дату).

Добавить запись в таблицу P2P.

Если задан статус "начало", в поле проверки указать только что добавленную запись. В противном случае, указать проверку с незавершенным P2P этапом.

2) Написать процедуру добавления проверки Verter'ом
Параметры: ник проверяемого, название задания, статус проверки Verter'ом, время.

Добавить запись в таблицу Verter и в поле проверки указать проверку соответствующего задания с самым поздним (по времени) успешным P2P этапом.

3) Написать триггер: после добавления записи со статусом "начало" в таблицу P2P, изменить соответствующую запись в таблице TransferredPoints.
4) Написать триггер: перед добавлением записи в таблицу XP, проверить корректность добавляемой записи.
Запись считается корректной, если:

Количество XP не превышает максимальное доступное для проверяемой задачи.
Поле Check ссылается на успешную проверку.
Если запись не прошла проверку, она не будет добавлена в таблицу.

Примечание: В данном описании была внесена некоторая структуризация и исправлены некоторые опечатки и ошибки форматирования.

## Part 3. Получение данных
Создайте скрипт part3.sql, в который внесите описанные далее процедуры и функции (считать процедурами все задания, в которых не указано, что это функция).

1) Написать функцию, возвращающую таблицу TransferredPoints в более человекочитаемом виде
Ник пира 1, ник пира 2, количество переданных пир поинтов.
Количество отрицательное, если пир 2 получил от пира 1 больше поинтов.

Пример вывода:

Peer1    Peer2    PointsAmount
Aboba    Amogus    5
Amogus    Sus    -2
Sus    Aboba    0
2) Написать функцию, которая возвращает таблицу вида: ник пользователя, название проверенного задания, кол-во полученного XP
В таблицу включать только задания, успешно прошедшие проверку (определять по таблице Checks).
Одна задача может быть успешно выполнена несколько раз. В таком случае в таблицу включать все успешные проверки.

Пример вывода:

Peer    Task    XP
Aboba    C8    800
Aboba    CPP3    750
Amogus    DO5    175
Sus    A4    325
3) Написать функцию, определяющую пиров, которые не выходили из кампуса в течение всего дня
Параметры функции: день, например 12.05.2022.
Функция возвращает только список пиров.

4) Посчитать изменение в количестве пир поинтов каждого пира по таблице TransferredPoints
Результат вывести отсортированным по изменению числа поинтов.
Формат вывода: ник пира, изменение в количество пир поинтов

Пример вывода:

Peer    PointsChange
Aboba    8
Amogus    1
Sus    -3
5) Посчитать изменение в количестве пир поинтов каждого пира по таблице, возвращаемой первой функцией из Part 3
Результат вывести отсортированным по изменению числа поинтов.
Формат вывода: ник пира, изменение в количество пир поинтов

Пример вывода:

Peer    PointsChange
Aboba    8
Amogus    1
Sus    -3


# Дополнительно. Part 4. Метаданные

Для выполнения данной части задания необходимо создать отдельную базу данных со всеми необходимыми таблицами, функциями, процедурами и триггерами для тестирования процедур.

Всю необходимую информацию нужно внести в файл *part4.sql*.

## Задания

1. Создать хранимую процедуру, которая уничтожает все таблицы текущей базы данных, имена которых начинаются с фразы 'TableName'. При этом необходимо сохранить базу данных.

2. Создать хранимую процедуру с выходным параметром, которая выводит список имен и параметров всех скалярных SQL функций пользователя в текущей базе данных. Имена функций без параметров выводить не следует. Имена и список параметров должны выводиться в одну строку. Выходной параметр должен возвращать количество найденных функций.

3. Создать хранимую процедуру с выходным параметром, которая уничтожает все SQL DML триггеры в текущей базе данных. Выходной параметр должен возвращать количество уничтоженных триггеров.

4. Создать хранимую процедуру с входным параметром, которая выводит имена и описания типа объектов (только хранимых процедур и скалярных функций), в тексте которых на языке SQL встречается строка, задаваемая параметром процедуры.

